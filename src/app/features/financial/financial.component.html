<div class="page">

  <div class="wrapper">

    <!-- Brand bar -->
    <div class="brand-bar">
      <div class="brand-dot"></div>
      <span class="brand-name">Geração de carnê de clientes</span>
    </div>

    <div class="card">
      <div class="card-strip"></div>

      <!-- Header -->
      <div class="card-header">
        <div class="icon-box">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
        </div>
        <div class="header-text">
          <h1>Consulta de Carnê</h1>
          <p>Geração de PDF via banco</p>
        </div>

        <!-- Botão sincronizar no canto direito do header -->
        <button class="btn-sync" (click)="openSyncDialog()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 4 23 10 17 10"/>
            <polyline points="1 20 1 14 7 14"/>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
          </svg>
          Sincronizar Cliente
        </button>
      </div>

      <!-- Body -->
      <div class="card-body">

        <div class="info-banner">
          <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
          <span>O cliente deve estar <strong>sincronizado com o sistema da Loja</strong> para que o carnê seja gerado corretamente. Caso necessário, utilize o botão <strong>Sincronizar Cliente</strong>.</span>
        </div>

        <div class="form-label-row">
          <span class="field-label">Número do Contrato</span>
        </div>

        <div class="input-wrap">
          <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
          </svg>
          <input
            type="text"
            [(ngModel)]="contractNumber"
            (keydown)="onKeyDown($event)"
            placeholder="ex: 0001234567"
            autocomplete="off"
            spellcheck="false"
            class="contract-input"
          />
        </div>

        <button class="btn" [disabled]="loading" (click)="fetchCarne()">
          <svg *ngIf="loading" class="spinner" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="rgba(255,255,255,0.3)" stroke-width="3"/>
            <path fill="white" d="M4 12a8 8 0 018-8v8z"/>
          </svg>
          <span>{{ loading ? 'Consultando...' : 'Gerar Carnê PDF' }}</span>
          <svg *ngIf="!loading" class="btn-icon" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </button>

        <div *ngIf="statusType" class="status" [ngClass]="statusType">
          <span class="status-icon">{{ statusIcon }}</span>
          <span class="status-text">{{ statusMessage }}</span>
        </div>

      </div>

      <!-- Footer -->
      <div class="card-footer">
        <div class="footer-badge">
          <span class="footer-dot">✦</span>
          <span>Santander Bank</span>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ── Dialog de Sincronização ── -->
<div class="dialog-overlay" *ngIf="syncDialogOpen" (click)="closeSyncDialog()">
  <div class="dialog" (click)="$event.stopPropagation()">

    <div class="dialog-header">
      <div class="dialog-icon-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <polyline points="23 4 23 10 17 10"/>
          <polyline points="1 20 1 14 7 14"/>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
      </div>
      <div>
        <h2>Sincronizar Cliente</h2>
        <p>Informe o CPF do cliente para sincronizar com o sistema da Loja.</p>
      </div>
      <button class="dialog-close" (click)="closeSyncDialog()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <div class="dialog-body">
      <label class="field-label">CPF do Cliente</label>
      <div class="input-wrap" style="margin-top: 0.4rem;">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
        <input
          type="text"
          [(ngModel)]="syncCpf"
          placeholder="000.000.000-00"
          autocomplete="off"
          class="contract-input"
          [disabled]="syncLoading"
          (keydown.enter)="syncClient()"
        />
      </div>

      <div *ngIf="syncStatusType" class="status" [ngClass]="syncStatusType" style="margin-top: 0.75rem;">
        <span class="status-icon">{{ syncStatusIcon }}</span>
        <span class="status-text">{{ syncStatusMessage }}</span>
      </div>
    </div>

    <div class="dialog-footer">
      <button class="btn-outline" (click)="closeSyncDialog()" [disabled]="syncLoading">
        Cancelar
      </button>
      <button class="btn btn-dialog" (click)="syncClient()" [disabled]="syncLoading">
        <svg *ngIf="syncLoading" class="spinner" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="10" stroke="rgba(255,255,255,0.3)" stroke-width="3"/>
          <path fill="white" d="M4 12a8 8 0 018-8v8z"/>
        </svg>
        <span>{{ syncLoading ? 'Sincronizando...' : 'Sincronizar' }}</span>
      </button>
    </div>

  </div>
</div>