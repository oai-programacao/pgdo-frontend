<!-- Container geral -->
<div
  class="md:p-6 bg-white dark:bg-slate-900  rounded-lg shadow-md"
>
  <div
    class="flex flex-col items-center gap-6 mx-auto bg-white p-6 rounded-2xl shadow   border border-gray-200"
  >
    <!-- Campos de busca -->
    <p-select
      [options]="clientTypeOptions"
      [(ngModel)]="clientType"
      placeholder="Selecione o tipo"
      (ngModelChange)="onClientTypeChange()"
      optionLabel="label"
      optionValue="value"
      class="w-full sm:w-3/4 md:w-2/3 lg:w-1/2"
    />

    @if(clientType === 'PF'){
    <input
      type="text"
      pInputText
      placeholder="CPF do Cliente"
      [(ngModel)]="cpfCnpj"
      mask="000.000.000-00"
      unmask="true"
      maxlength="14"
      [disabled]="!clientType"
      class="w-full sm:w-3/4 md:w-2/3 lg:w-1/2 py-3 px-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition"
    />
    } @if(clientType === 'PJ'){
    <input
      type="text"
      pInputText
      placeholder="CNPJ do Cliente"
      [(ngModel)]="cpfCnpj"
      mask="00.000.000/0000-00"
      unmask="true"
      maxlength="18"
      [disabled]="!clientType"
      class="w-full sm:w-3/4 md:w-2/3 lg:w-1/2 py-3 px-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition"
    />
    }

    <!-- Botão de consulta -->
    <div class="w-full sm:w-3/4 md:w-2/3 lg:w-1/2 flex justify-center">
      <p-button
        icon="pi pi-search"
        (onClick)="consultClient(); registerNewClient()"
        label="Consultar Cliente"
        severity="info"
        [disabled]="!cpfCnpj || !clientType"
        class="w-full sm:w-auto"
      />
    </div>

    <!-- Estados de carregamento e mensagens -->
    @if(isLoading){
    <div class="flex justify-center w-full py-4">
      <p-progress-spinner ariaLabel="isLoading" />
    </div>
    } @else if(!hasSearched){
    <div class="text-center text-gray-500">
      <p class="text-sm">Por favor, faça uma consulta.</p>
    </div>
    } @else if(!isLoading && hasSearched && (!dataClient || dataClient.length
    === 0)) {
    <div class="text-center text-gray-500">
      <p class="text-sm">Nenhum cliente encontrado.</p>
      <div class="mt-2">
        <p-button
          label="Registrar Novo Cliente"
          [outlined]="true"
          (onClick)="confirmToRegisterNewClient($event, cpfCnpj)"
        />
      </div>
    </div>
    } @else {

<div class="flex flex-col gap-4 w-full ">
  <div
    *ngFor="let client of dataClient; let i = index"
    class="flex flex-col lg:flex-row lg:items-start justify-between p-6 gap-6 bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 w-full"
  >
    <!-- Nome -->
    <div class="flex-1 min-w-[9.375rem]">
      <span class="text-[11px] text-gray-400 uppercase tracking-wider mb-1 block">Nome</span>
      <span class="font-semibold text-gray-800 truncate block">
        {{ clientType === "PJ" ? client.companyName : client.name }}
      </span>
    </div>

    <!-- Código do plano -->
    <div class="flex-1 min-w-[7.5rem] text-center lg:text-left">
      <span class="text-[0.6875rem] text-gray-400 uppercase tracking-wider mb-1 block">Código do plano</span>
      <span class="text-gray-700 font-medium truncate block">
        {{ client.contracts[0]?.planCode || " - " }}
      </span>
    </div>

    <!-- Endereço -->
    <div class="flex-1 min-w-[12.5rem]">
      <span class="text-[0.6875rem] text-gray-400 uppercase tracking-wider mb-1 block">Endereço</span>
      <span class="text-gray-600 font-medium truncate block">
        {{ client.addresses[0]?.street }},
        {{ client.addresses[0]?.number }},
        {{ client.addresses[0]?.neighborhood }},
        {{ client.addresses[0]?.city }}
      </span>
    </div>

    <!-- Telefone -->
    <div class=" min-w-[6.25rem] text-center lg:text-left">
      <span class="text-[0.6875rem] text-gray-400 uppercase tracking-wider mb-1 block">Telefone</span>
      <span class="text-gray-700 font-medium truncate block">
        {{
          clientType === "PJ" ? client.mobilePhone : (client.phone | phones ) || " - "
        }}
      </span>
    </div>

    <!-- Qtd. de Contrato -->
    <div class="f min-w-[6.25rem] text-center lg:text-left">
      <span class="text-[0.6875rem] text-gray-400 uppercase tracking-wider mb-1 block">Qtd. de Contrato</span>
      <span class="text-gray-700 font-medium truncate block">
        @if(client.contracts && client.contracts.length > 0) {
          {{ client.contracts.length }}
        } @else {
          0
        }
      </span>
    </div>

    <!-- Botões -->
    <div class="flex gap-2 justify-center lg:justify-end  lg:mt-0">
      <p-button
        icon="pi pi-plus"
        [rounded]="true"
        [text]="true"
        pTooltip="Criar Novo Contrato"
        severity="success"
        (onClick)="createNewContractVisible(client)"
      />
      <p-button
        icon="pi pi-eye"
        [rounded]="true"
        [text]="true"
        pTooltip="Ver Detalhes"
        severity="info"
        (onClick)="viewClient(client)"
      />
    </div>
  </div>
</div>
    }
  </div>
</div>

<p-toast />
<p-confirmpopup />

  <p-dialog
    [(visible)]="createNewContractDialog"
    header="Cadastrar Novo Contrato"
    [modal]="true"
    [draggable]="false"
    position="top"
    [resizable]="false"
    [style]="{ width: '85vw', height: '60vh' }"
  >
    <app-create-contract
      [isPJorPF]="clientType"
      [clientData]="dataClient"
    ></app-create-contract>
  </p-dialog>