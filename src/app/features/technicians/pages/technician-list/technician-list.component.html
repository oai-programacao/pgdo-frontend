  <div class="p-4 md:p-6 bg-white dark:bg-slate-900 rounded-lg shadow">
    <p-toast position="bottom-right"></p-toast>
    <p-confirmDialog [style]="{width: '50vw'}" acceptButtonStyleClass="p-button-success" rejectButtonStyleClass="p-button-outlined p-button-secondary"></p-confirmDialog>
  
    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
      <h1 class="text-2xl font-semibold text-slate-800 dark:text-slate-100">Gerenciamento de Técnicos</h1>
      <button pButton label="Novo Técnico" icon="pi pi-plus" (click)="showCreateDialog()" class="p-button-success"></button>
    </div>
  
    <div class="mb-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 p-4 dark:border-slate-700 rounded-md bg-slate-50 dark:bg-slate-800">
      <div>
        <label for="filterTechnicianStatus" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Status</label>
        <p-select
          appendTo="body" id="filterTechnicianStatus"
          [options]="filterIsActiveOptions"
          [(ngModel)]="selectedIsActive" optionLabel="label"
          placeholder="Todos os Status"
          (onChange)="onFilterChange()"
          styleClass="w-full"
          /> 
      </div>
    </div>
  
    <p-table
        [value]="technicians"
        [loading]="isLoading"
        responsiveLayout="scroll"
        styleClass="p-datatable-striped p-datatable-gridlines"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 25, 50]"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} técnicos" [showCurrentPageReport]="true">
      <ng-template pTemplate="header">
        <tr>
          <th class="p-4 text-left w-[25%] text-sm font-semibold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700">Nome</th>
          <th class="p-4 text-left w-[25%] text-sm font-semibold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700">Email</th>
          <th class="p-4 text-left w-[20%] text-sm font-semibold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700">Usuário RBX</th> <th class="p-4 text-center w-[15%] text-sm font-semibold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700">Status</th>
          <th class="p-4 text-center w-[15%] text-sm font-semibold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700">Ações</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-technician> <tr>
          <td class="p-4 whitespace-nowrap text-sm text-slate-700 dark:text-slate-200">{{ technician.name }}</td>
          <td class="p-4 whitespace-nowrap text-sm text-slate-700 dark:text-slate-200">{{ technician.email }}</td>
          <td class="p-4 whitespace-nowrap text-sm text-slate-700 dark:text-slate-200">{{ technician.rbxUsername || '-' }}</td> <td class="p-4 whitespace-nowrap text-sm text-center">
            <p-tag [value]="technician.isActive ? 'Ativo' : 'Inativo'" [severity]="getSeverityForStatus(technician.isActive)"></p-tag>
          </td>
          <td class="p-4 whitespace-nowrap text-sm text-center space-x-2">
            <button pButton type="button" icon="pi pi-pencil" class="p-button-rounded p-button-info p-button-outlined" (click)="showUpdateDialog(technician)" pTooltip="Editar Técnico" tooltipPosition="top"></button>
            </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
          <tr>
              <td colspan="5" class="p-4 text-center text-slate-500 dark:text-slate-400">Nenhum técnico encontrado.</td> </tr>
      </ng-template>
    </p-table>
  </div>
  
  <p-dialog header="Novo Técnico" [(visible)]="displayCreateDialog" [modal]="true" [style]="{width: '50vw', minWidth: '450px'}" [draggable]="false" [resizable]="false" (onHide)="createTechnicianForm.reset()">
    <form [formGroup]="createTechnicianForm" (ngSubmit)="createTechnician()" class="space-y-6 p-fluid w-full">
      <div>
        <label for="create-technician-name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Nome Completo</label>
        <input id="create-technician-name" type="text" pInputText formControlName="name" class="w-full"
               [ngClass]="{'ng-invalid ng-dirty': createTechnicianForm.get('name')?.invalid && createTechnicianForm.get('name')?.touched}"/>
        <small *ngIf="createTechnicianForm.get('name')?.invalid && createTechnicianForm.get('name')?.touched" class="p-error block mt-1">Nome é obrigatório.</small>
      </div>
      <div>
        <label for="create-technician-email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
        <input id="create-technician-email" type="email" pInputText formControlName="email" class="w-full"
               [ngClass]="{'ng-invalid ng-dirty': createTechnicianForm.get('email')?.invalid && createTechnicianForm.get('email')?.touched}"/>
        <small *ngIf="createTechnicianForm.get('email')?.errors?.['required'] && createTechnicianForm.get('email')?.touched" class="p-error block mt-1">Email é obrigatório.</small>
        <small *ngIf="createTechnicianForm.get('email')?.errors?.['email'] && createTechnicianForm.get('email')?.touched" class="p-error block mt-1">Formato de email inválido.</small>
      </div>
      <div> 
          <label for="create-technician-rbxUsername" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Usuário RBX</label>
          <input id="create-technician-rbxUsername" type="text" pInputText formControlName="rbxUsername" class="w-full"  [ngClass]="{'ng-invalid ng-dirty': createTechnicianForm.get('rbxUsername')?.invalid && createTechnicianForm.get('rbxUsername')?.touched}"/>
          <small *ngIf="createTechnicianForm.get('rbxUsername')?.invalid && createTechnicianForm.get('rbxUsername')?.touched" class="p-error block mt-1">Usuário RBX é obrigatório.</small>
      </div>
  
      <div class="flex justify-end space-x-3 pt-4">
        <button pButton type="button" label="Cancelar" (click)="displayCreateDialog=false" class="p-button-text"></button>
        <button pButton type="submit" label="Salvar" icon="pi pi-check" [loading]="isSubmitting" [disabled]="createTechnicianForm.invalid || isSubmitting"></button>
      </div>
    </form>
  </p-dialog>
  
  <p-dialog header="Atualizar Técnico" [(visible)]="displayUpdateDialog" [modal]="true" [style]="{width: '50vw', minWidth: '450px'}" [draggable]="false" [resizable]="false" (onHide)="updateTechnicianForm.reset()">
    <form [formGroup]="updateTechnicianForm" (ngSubmit)="updateTechnician()" class="space-y-6 p-fluid w-full">
      <div>
        <label for="update-technician-name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Nome Completo</label>
        <input id="update-technician-name" type="text" pInputText formControlName="name" class="w-full"
               [ngClass]="{'ng-invalid ng-dirty': updateTechnicianForm.get('name')?.invalid && updateTechnicianForm.get('name')?.touched}"/>
        <small *ngIf="updateTechnicianForm.get('name')?.invalid && updateTechnicianForm.get('name')?.touched" class="p-error block mt-1">Nome é obrigatório.</small>
      </div>
      <div>
        <label for="update-technician-email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
        <input id="update-technician-email" type="email" pInputText formControlName="email" class="w-full"
               [ngClass]="{'ng-invalid ng-dirty': updateTechnicianForm.get('email')?.invalid && updateTechnicianForm.get('email')?.touched}"/>
        <small *ngIf="updateTechnicianForm.get('email')?.errors?.['required'] && updateTechnicianForm.get('email')?.touched" class="p-error block mt-1">Email é obrigatório.</small>
        <small *ngIf="updateTechnicianForm.get('email')?.errors?.['email'] && updateTechnicianForm.get('email')?.touched" class="p-error block mt-1">Formato de email inválido.</small>
      </div>
      <div>
        <label for="update-technician-rbxUsername" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Usuário RBX</label>
        <input id="update-technician-rbxUsername" type="text" pInputText formControlName="rbxUsername" class="w-full" />
      </div>
      <div class="field flex items-center gap-3"> <p-inputSwitch inputId="update-technician-isActive" formControlName="isActive"></p-inputSwitch>
        <label for="update-technician-isActive" class="ml-2 text-sm font-medium text-slate-700 dark:text-slate-300">Ativo</label>
        <small *ngIf="updateTechnicianForm.get('isActive')?.invalid && updateTechnicianForm.get('isActive')?.touched" class="p-error block mt-1">Status é obrigatório.</small>
      </div>
  
      <div class="flex justify-end space-x-3 pt-4">
        <button pButton type="button" label="Cancelar" (click)="displayUpdateDialog=false" class="p-button-text"></button>
        <button pButton type="submit" label="Salvar Alterações" icon="pi pi-check" [loading]="isSubmittingUpdate" [disabled]="updateTechnicianForm.invalid || isSubmittingUpdate"></button>
      </div>
    </form>
  </p-dialog>